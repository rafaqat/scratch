---
id: S-0004-01
title: "Folder tree sidebar"
status: Done
estimate_points: 8
tags: [navigation, sidebar, folders]
owner: "claude"
created_at: "2026-02-14"
started_at: "2026-02-15"
completed_at: "2026-02-15 13:03"
target_version: "v1.2.0"
commits: []
links:
  epic: E-0004-scratch-v3
  blocks: [S-0004-02, S-0004-03]
---

[← Roadmap](../Scratch v3 Roadmap.md) · Folder Hierarchy · **1 of 3**
Blocks: [S-0004-02 Breadcrumbs](S-0004-02.md), [S-0004-03 Drag-and-drop](S-0004-03.md)
Next: [S-0004-02 →](S-0004-02.md)

---

Replace the flat note list with a recursive folder tree that mirrors the filesystem. Users can create, rename, and delete folders directly from the sidebar.

## Acceptance Criteria

- [ ] Sidebar displays a collapsible folder tree reflecting the notes directory structure
- [ ] Folders can be expanded/collapsed with a chevron toggle
- [ ] Collapse state persisted across sessions (in `.scratch/ui-state.json`)
- [ ] Right-click context menu on folders: New Note, New Subfolder, Rename, Delete
- [ ] Right-click context menu on notes within folders: same as current note context menu
- [ ] Creating a note inside a folder saves it to that folder's path
- [ ] Pinned notes section remains at the top, above the folder tree
- [ ] Search results still show as a flat list (not nested)
- [ ] File watcher handles nested directory changes (create/delete/rename folders)
- [ ] Empty folders display a subtle placeholder

## Technical Notes

**Backend changes (lib.rs):**
- `list_notes` must scan recursively and return relative paths from notes root
- Add `create_folder`, `rename_folder`, `delete_folder` Tauri commands
- File watcher already uses notify which supports recursive watching

**Frontend changes:**
- New `FolderTree` component replaces the flat `NoteList`
- Note IDs become relative paths (e.g., `projects/my-note.md` instead of `my-note.md`)
- `NotesContext` must handle path-based note IDs throughout
- This is the most invasive change — touches note creation, selection, saving, and display

**State persistence:**
- Store expanded folder IDs in `.scratch/ui-state.json`
- Load on startup, save on toggle

## Activity Log

| Date | Event | Details |
|------|-------|---------|
| 2026-02-14 | Created | Story added to E-0004 roadmap |
| 2026-02-15 | Started | Claimed by claude |
| 2026-02-15 13:03 | Done | All acceptance criteria met (retroactive) |
