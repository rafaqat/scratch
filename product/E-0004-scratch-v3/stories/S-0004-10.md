---
id: S-0004-10
title: "Note version history"
status: Done
estimate_points: 5
tags: [history, versions, safety]
owner: "claude"
created_at: "2026-02-14"
started_at: "2026-02-15"
completed_at: "2026-02-15 13:03"
target_version: "v1.2.0"
commits: []
links:
  epic: E-0004-scratch-v3
---

[← Roadmap](../Scratch v3 Roadmap.md) · Trash & Version History · **2 of 2**
Prev: [← S-0004-09](S-0004-09.md) · Next: [S-0004-11 →](S-0004-11.md)

---

Track note versions over time. View and restore previous versions of any note.

## Acceptance Criteria

- [ ] Snapshot saved automatically on each save (debounced — max 1 snapshot per 5 minutes)
- [ ] Version history accessible via note context menu or Cmd+Shift+H
- [ ] History panel shows list of versions with timestamps
- [ ] Clicking a version shows a read-only preview of that version
- [ ] "Restore this version" button replaces current note content
- [ ] Diff view: highlight what changed between two versions (optional, stretch)
- [ ] Storage limit: keep last 50 versions per note, oldest auto-deleted
- [ ] Total history size capped at 100MB per notes folder (oldest purged first)
- [ ] History excluded from search index

## Technical Notes

**Storage:**
```
.scratch/history/
└── {note-filename}/
    ├── 2026-02-14T04-30-00Z.md
    ├── 2026-02-14T04-35-00Z.md
    └── ...
```

**Backend (lib.rs):**
- Hook into `save_note` to snapshot before overwriting
- Debounce: check last snapshot timestamp, skip if < 5 min
- New commands: `list_versions`, `read_version`, `restore_version`
- Startup: run purge check (50 version limit, 100MB cap)

**Frontend:**
- History panel as a right sidebar or modal
- Each version shows: timestamp, file size, preview snippet
- Restore creates a new snapshot of the current state before replacing

**Note:** If git integration is enabled, this complements (not replaces) git history. Git tracks explicit commits; version history tracks automatic snapshots.

## Activity Log

| Date | Event | Details |
|------|-------|---------|
| 2026-02-14 | Created | Story added to E-0004 roadmap |
| 2026-02-15 | Started | Claimed by claude |
| 2026-02-15 13:03 | Done | All acceptance criteria met (retroactive) |
