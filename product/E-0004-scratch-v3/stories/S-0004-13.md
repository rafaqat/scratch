---
id: S-0004-13
title: "Database relations & rollups"
status: Done
estimate_points: 3
tags: [databases, relations, rollups]
owner: "claude"
created_at: "2026-02-14"
started_at: "2026-02-15"
completed_at: "2026-02-15 13:03"
target_version: "v1.2.0"
commits: []
links:
  epic: E-0004-scratch-v3
---

[← Roadmap](../Scratch v3 Roadmap.md) · Database Enhancements · **3 of 3**
Prev: [← S-0004-12](S-0004-12.md) · Next: [S-0004-14 →](S-0004-14.md)

---

Link rows between databases and compute aggregate values from related rows.

## Acceptance Criteria

- [ ] New column type: `relation` — links to rows in another database
- [ ] Relation cells show linked row titles as clickable tags
- [ ] Clicking a relation tag opens the linked row
- [ ] Relation picker: search and select rows from the target database
- [ ] Multiple relations per cell (one-to-many)
- [ ] New column type: `rollup` — aggregates values from related rows
- [ ] Rollup functions: Count, Sum, Average, Min, Max, Percent checked
- [ ] Rollup configuration: select relation column + target column + function
- [ ] Relations stored in frontmatter as an array of row IDs

## Technical Notes

**Schema definition:**
```yaml
columns:
  - id: project
    name: Project
    type: relation
    target_database: projects
  - id: total_hours
    name: Total Hours
    type: rollup
    relation: project
    target_column: hours
    function: sum
```

**Frontmatter storage for relations:**
```yaml
---
project: ["row-id-1", "row-id-2"]
---
```

**Implementation:**
- Relations resolved at render time by loading the target database's rows
- Rollups computed client-side from loaded relation data
- This is the Notion feature with the highest "power user" value but moderate implementation effort since the database infrastructure already exists

## Activity Log

| Date | Event | Details |
|------|-------|---------|
| 2026-02-14 | Created | Story added to E-0004 roadmap |
| 2026-02-15 | Started | Claimed by claude |
| 2026-02-15 13:03 | Done | All acceptance criteria met (retroactive) |
