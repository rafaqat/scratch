---
id: S-0003-14
title: "Plugin manifest system"
status: Done
estimate_points: 5
tags: [mcp, plugins, backend]
owner: "claude"
created_at: "2026-02-13"
started_at: "2026-02-13"
completed_at: "2026-02-13"
target_version: ""
commits: ["e5d8d49"]
links:
  epic: E-0003-scratch-v2
  blocks: [S-0003-15]
---

[← Roadmap](../Scratch v2 Roadmap.md) · MCP Plugins · **2 of 3**
Blocks: [S-0003-15 Built-in plugins](S-0003-15.md)
Prev: [← S-0003-13](S-0003-13.md) · Next: [S-0003-15 →](S-0003-15.md)

---

Plugin system that lets AI agents and users extend Scratch with new MCP tools.

## Acceptance Criteria

- [x] `.scratch/plugins/` directory for plugin manifests (YAML)
- [x] Plugin manifest defines: name, description, MCP tools, webhook handlers
- [x] Custom MCP tools defined in plugins are auto-registered on server start
- [x] Tool implementations can be: shell commands, HTTP calls, or note operations
- [x] Plugin enable/disable in settings UI
- [x] Plugin validation on load (schema check, permissions review)

## Technical Notes

Plugin manifest format:
```yaml
name: github-sync
version: 1.0.0
description: Sync GitHub issues to Scratch notes
tools:
  - name: github_sync_issues
    description: "Fetch open issues from a GitHub repo"
    params:
      repo: {type: string, required: true}
    action:
      type: shell
      command: "gh issue list --repo {{repo}} --json title,body,number"
      output: create_notes
webhooks:
  - path: github
    events: [issues.opened, issues.closed]
```


## Results

### Files Modified
- `src-tauri/src/plugins.rs` — New module: plugin manifest types, YAML loading, validation (schema + permissions), MCP tool generation, tool execution (shell/http/note_op), enable/disable, frontend info API
- `src-tauri/src/mcp.rs` — `tools/list` now includes plugin-defined tools; `tools/call` dispatches to plugin tools via `plugin_` prefix
- `src-tauri/src/lib.rs` — Registered `plugins` module, added `plugins_list`, `plugins_toggle`, `plugins_validate` Tauri commands
- `src-tauri/Cargo.toml` — Added `process` and `io-util` tokio features for shell command execution and HTTP client
- `src/types/note.ts` — Added `PluginInfo`, `PluginValidation` types
- `src/components/settings/McpSettingsSection.tsx` — Added plugin management section with enable/disable toggles, validation display

### Key Design Decisions
- Plugin tool names are prefixed with `plugin_{plugin_name}_` to avoid conflicts with built-in tools
- Three action types supported: `shell` (subprocess), `http` (raw TCP HTTP/1.1), `note_op` (CRUD via existing note APIs)
- Validation checks: required fields, semver format, action type requirements, permission declarations vs actual usage
- Permission model: 8 defined permissions (notes:read/write/delete, shell:execute, http:request, folders:read/write, search)
- Plugins can be toggled without restarting the server — tools/list dynamically loads enabled plugins
- HTTP client uses raw TCP to avoid adding reqwest dependency

## Activity Log

| Date | Event | Details |
|------|-------|---------|
| 2026-02-13 | Created | Story added to E-0003 roadmap |
| 2026-02-13 | Started | Assigned to claude, implementation begun |
| 2026-02-13 | Design | Plugin manifest system: YAML-based plugin definitions in .scratch/plugins/. Each plugin declares MCP tools (shell/http/note_op implementations), webhook handlers, and permissions. Plugins auto-register tools at MCP server start. Validation checks required fields and permission scoping. Settings UI for enable/disable per plugin. |
| 2026-02-13 | Implemented | All 6 acceptance criteria completed. Rust plugin module with full manifest system, tool generation, execution engine, validation. Frontend plugin management UI with enable/disable toggles. |
| 2026-02-13 | Done | All criteria verified, compilation clean |
