---
id: S-0003-02
title: "Table view block"
status: Done
estimate_points: 5
tags: [database, frontend, blocknote]
owner: "claude"
created_at: "2026-02-13"
started_at: "2026-02-13 21:50"
completed_at: "2026-02-13 22:04"
target_version: ""
commits: []
links:
  epic: E-0003-scratch-v2
  blockedBy: [S-0003-01]
---
[← Roadmap](../README.md) · Databases · **2 of 4**\
Blocked by: [S-0003-01 Schema](S-0003-01.md)\
Prev: [← S-0003-01](S-0003-01.md) · Next: [S-0003-03 →](S-0003-03.md)

***

Custom BlockNote block that renders database rows as an editable table.

## Acceptance Criteria

* [x] `/database` slash command inserts a table view block
* [x] Renders rows from a linked database folder as editable table
* [x] Column sorting (click header)
* [x] Column filtering (dropdown per column)
* [x] Inline cell editing with type-aware inputs
* [x] Add/delete rows from table UI
* [x] Add/remove/reorder columns
* [x] Serializes to markdown as a reference: `[database:my-tasks](view:table)`

## Design Decisions

1. **Database reference storage**: The block stores `databaseName` (the folder ID/slug) as a prop. This is the same ID used by the database service layer to fetch schema and rows via Tauri commands.

2. **Component architecture**: The block spec delegates rendering to a separate `DatabaseTableRenderer` component. This keeps the `createReactBlockSpec` call clean and allows the complex table UI (sorting, filtering, editing, column management) to live in its own component with proper state management.

3. **Cell editing approach**: Inline editing directly in the table cells. Each cell renders a type-aware input on click (text input, number input, date picker, select dropdown, checkbox toggle, multi-select checkboxes). This matches the Notion-style editing experience and avoids modal popups.

4. **Column management**: Add column via a "+" button at the end of the header row. Remove/reorder columns via a column header context menu. Column reorder uses move-left/move-right actions rather than drag-and-drop to keep complexity manageable.

5. **Markdown serialization**: Serializes as `[database:my-tasks](view:table)` and parses the same format back via pre/post processing utilities in `src/lib/databaseRef.ts`.

## Technical Notes

Use BlockNote `createReactBlockSpec` for the custom block. Fetch data via Tauri commands. Table rendering with CSS — no heavy table library needed.

## Results

### Files Created
- `src/components/editor/DatabaseTable.tsx` — Custom BlockNote block spec with full table UI
- `src/lib/databaseRef.ts` — Markdown round-trip pre/post processing for `[database:name](view:table)` syntax

### Files Modified
- `src/components/editor/schema.ts` — Registered `databaseTable` block spec
- `src/components/editor/Editor.tsx` — Added `/database` slash menu item and database ref pre/post processing
- `src/App.css` — Added complete CSS styles for the database table block

### Implementation Details
- **Block spec**: `createReactBlockSpec` with `databaseName` prop and `content: "none"`
- **Database picker**: Shown when no database is linked; lists existing databases or creates new ones
- **Table rendering**: Full-featured table with sortable columns (click header to toggle), per-column filter dropdown, inline cell editing with type-aware inputs for all 8 column types
- **Row management**: Add row button at bottom, delete button (trash icon) per row (appears on hover)
- **Column management**: Add column via "+" header button with name/type popover; column header menu with sort, move left/right, and delete options
- **Markdown round-trip**: `preprocessDatabaseRefs` converts `[database:name](view:table)` to HTML div for parsing; `postprocessDatabaseRefs` converts back on save

## Activity Log

| Date       | Event     | Details                       |
| ---------- | --------- | ----------------------------- |
| 2026-02-13 | Created   | Story added to E-0003 roadmap |
| 2026-02-13 | Started   | Claimed by claude, beginning implementation |
| 2026-02-13 | Completed | All acceptance criteria met, build passes |
