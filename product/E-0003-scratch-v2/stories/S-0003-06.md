---
id: S-0003-06
title: "Backlinks panel"
status: Done
estimate_points: 3
tags: [wikilinks, frontend]
owner: "claude"
created_at: "2026-02-13"
started_at: "2026-02-13 21:34"
completed_at: "2026-02-13 21:45"
target_version: ""
commits: ["24a0e9a"]
links:
  epic: E-0003-scratch-v2
  blockedBy: [S-0003-05]
---

[← Roadmap](../README.md) · Wikilinks · **2 of 2**
Blocked by: [S-0003-05 Wikilinks](S-0003-05.md)
Prev: [← S-0003-05](S-0003-05.md) · Next feature: [S-0003-07 Callouts →](S-0003-07.md)

---

Show "Linked mentions" at the bottom of each note.

## Acceptance Criteria

- [x] Backlinks panel below editor content showing all notes that link to current note
- [x] Each backlink shows: note title, surrounding context snippet, click to navigate
- [x] Collapsible panel (default expanded if backlinks exist)
- [x] Updates when notes are saved (incremental index update)
- [x] Backlinks index stored at `.scratch/backlinks.json`
- [x] Index rebuilt on app startup, updated incrementally on note save/delete/rename

## Technical Notes

Backlinks index format:
```json
{
  "note-id": ["linking-note-1", "linking-note-2"]
}
```

Rebuild by scanning all notes for `[[...]]` patterns on startup. On save, diff old/new wikilinks and update index. Expose via Tauri command for frontend.


## Activity Log

| Date | Event | Details |
|------|-------|---------|
| 2026-02-13 | Created | Story added to E-0003 roadmap |
| 2026-02-13 | Started | Claimed by claude, implementation begun |
| 2026-02-13 | Design | Rust backend: `rebuild_backlinks_index` + `get_backlinks` + `update_backlinks_for_note` commands. Index stored at `.scratch/backlinks.json` mapping lowercase title -> array of `{noteId, noteTitle, context}`. Frontend: `BacklinksPanel` component below editor, collapsible, shows title + context snippet + click-to-navigate. Index rebuilt on startup in `set_notes_folder`, updated incrementally in `save_note_impl` and `delete_note_impl`. |
| 2026-02-13 | Commit | `24a0e9a` — Add backlinks panel with linked mentions |
| 2026-02-13 | Done | All 6 acceptance criteria met and checked |

## Results

### Files Created
- `src/components/editor/BacklinksPanel.tsx` — Collapsible backlinks panel component

### Files Modified
- `src/services/notes.ts` — Added `getBacklinks()` and `rebuildBacklinks()` service functions
- `src-tauri/src/lib.rs` — Backlinks index infrastructure (structs, Tauri commands, incremental updates in save/delete, startup rebuild)
- `src/components/editor/Editor.tsx` — BacklinksPanel integration below BlockNoteView (committed in prior session)

### Architecture
- **Index format**: `.scratch/backlinks.json` stores `{ links: { "lowercase-title": [{ noteId, noteTitle, context }] } }`
- **Rebuild**: Full rebuild on app startup and `set_notes_folder`; incremental update on every `save_note` and `delete_note`
- **Wikilink scanning**: Regex `\[\[([^\]]+)\]\]` with alias support (`[[Title|alias]]`)
- **Context extraction**: Extracts the line containing the wikilink, strips markdown formatting, truncates to 120 chars
- **Refresh trigger**: Panel refetches when `notes` list changes (triggered by saves via `scheduleRefresh`)
