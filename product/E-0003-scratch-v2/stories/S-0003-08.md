---
id: S-0003-08
title: "Equation block"
status: Done
estimate_points: 3
tags: [blocks, frontend, blocknote]
owner: "claude"
created_at: "2026-02-13"
started_at: "2026-02-13T20:00:00Z"
completed_at: "2026-02-13"
target_version: ""
commits: []
links:
  epic: E-0003-scratch-v2
---
[← Roadmap](../Scratch v2 Roadmap.md) · Richer Blocks · **2 of 4**\
\
Prev: [← S-0003-07](S-0003-07.md) · Next: [S-0003-09 →](S-0003-09.md)

***

KaTeX-powered math rendering.

## Acceptance Criteria

* [x] `/equation` slash command inserts block equation
* [x] Block mode: `$$...$$` rendered as centered display math
* [x] Inline mode: `$...$` rendered inline within text
* [x] Click-to-edit with live preview
* [x] KaTeX error display for invalid LaTeX
* [x] Serializes as `$$...$$` (block) and `$...$` (inline) in markdown

## Technical Notes

Add `katex` npm dependency. Block equation as custom BlockNote block. Inline equation as custom inline content/mark. Consider `@blocknote/katex` if it exists, otherwise custom implementation.

## Results

**Files created:**
- `src/components/editor/EquationBlock.tsx` - Block equation (display math) with click-to-edit, live KaTeX preview, and HTML parse support
- `src/components/editor/InlineEquation.tsx` - Inline equation ($...$) with click-to-edit and KaTeX rendering
- `src/lib/equation.ts` - Postprocessor to restore `$$...$$` syntax in exported markdown

**Files modified:**
- `src/components/editor/schema.ts` - Added equation block and inline equation to BlockNote schema
- `src/components/editor/Editor.tsx` - Added `/equation` slash menu item, KaTeX CSS import, equation postprocessor in save pipeline
- `src/lib/wikilink.ts` - Extended block tree injection to handle `$$...$$` block equations and `$...$` inline equations
- `src/App.css` - Added styles for equation blocks and inline equations
- `package.json` - Added `katex` and `@types/katex` dependencies

## Activity Log

| Date       | Event       | Details                       |
| ---------- | ----------- | ----------------------------- |
| 2026-02-13 | Created     | Story added to E-0003 roadmap |
| 2026-02-13 | Started     | Claimed by claude, implementation begun |
| 2026-02-13 | Implemented | All acceptance criteria complete |
| 2026-02-13 | Done        | Story complete |
