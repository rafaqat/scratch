---
id: S-0003-10
title: "Table of contents block"
status: Done
estimate_points: 2
tags: [blocks, frontend, blocknote]
owner: "claude"
created_at: "2026-02-13"
started_at: "2026-02-13 21:33"
completed_at: "2026-02-13 22:10"
target_version: ""
commits:
  - 8228c0f
links:
  epic: E-0003-scratch-v2
---

[← Roadmap](../README.md) · Richer Blocks · **4 of 4**
Prev: [← S-0003-09](S-0003-09.md) · Next feature: [S-0003-11 Templates →](S-0003-11.md)

---

Auto-generated TOC from headings.

## Acceptance Criteria

- [x] `/toc` slash command inserts a table of contents block
- [x] Lists all headings (H1-H3) with indentation by level
- [x] Click heading entry scrolls to that heading
- [x] Live updates as headings are added/removed/edited
- [x] Serializes as `[toc]` placeholder in markdown
- [x] Styled to look unobtrusive (lighter text, compact)

## Technical Notes

BlockNote custom block that reads the editor's block tree to find heading blocks. Re-renders on editor content change (debounced). Simple implementation — just query heading blocks from the editor API.


## Design Decisions

1. **Shared schema file** — Create `src/components/editor/schema.ts` to combine `defaultBlockSpecs` with custom blocks and `defaultInlineContentSpecs` with wikilinks. This avoids circular dependencies and makes it easy to add more custom blocks later.
2. **Content: "none"** — TOC block has no editable inline content. It renders a read-only list of heading entries.
3. **Live updates** — Use `editor.onChange` subscription inside the block's render to re-scan headings on every content change, debounced at 100ms.
4. **Click-to-scroll** — Each heading entry dispatches a `focusBlock` call on the editor to scroll to the heading block.
5. **Markdown round-trip** — `toExternalHTML` renders `<p>[toc]</p>` so `blocksToMarkdownLossy` produces `[toc]`. On import, `injectTocBlocks` in `wikilink.ts` converts `[toc]` paragraphs into TOC block nodes.
6. **Slash menu** — Add `/toc` and `/table of contents` as aliases via `getCustomSlashMenuItems` with `insertOrUpdateBlockForSlashMenu`.

## Activity Log

| Date | Event | Details |
|------|-------|---------|
| 2026-02-13 | Created | Story added to E-0003 roadmap |
| 2026-02-13 | Started | Implementation started by claude |
